<!-- Include header -->
<%- include common/header.ejs %>

<section class="how-to-use-tip">
  <div class="row center">

    <h4>
      If you need to know how to use this, please take a look <a href="/">HERE</a>.
    </h4>

  </div>
</section>

<section class="main-image-query grid-container">
  <div class="grid-x grid-padding-x">

    <div class="large-6 cell">
      <img src="<%= pathToImages %><%= newImageObj.src %>" />
    </div>

    <div class="autocomplete-keywords-container large-6 cell">

      <form class="autocomplete-form" action="/collector/" method="POST">
        <div class="control-wrapper">

          <input type="text" id="query" tabindex="1" name="query">

          <div class="ui-widget" style="margin-top:2em; font-family:Arial">
            Result:
            <div id="log" style="height: 200px; width: 300px; overflow: auto;" class="ui-widget-content"></div>
          </div>

        </div>
        <input type="submit" class="button success" id="sendQuery" value="Send query">
      </form>

      <!-- Autocomplete AJAX script -->
      <script>

        function log( message ) {
          $( "<div>" ).text( message ).prependTo( "#log" );
          $( "#log" ).scrollTop( 0 );
        }  

        $('#query').autocomplete({
          delay: 10,
          source: function (req, res) {
            $.ajax({
              url: "/collector_ajax/",
              dataType: "jsonp",
              type: "GET",
              data: {
                term: req.term
              },
              success: function (data) {
                res($.map(data, function (item) {
                  return {
                    id: item[0],
                    label: item[1], 
                    value: item[1],
                    desc: item[2]
                  };      
                }));

                //console.log(data);
                //res(data);
              },
              error: function (xhr) {
                alert(xhr.status + ' : ' + xhr.statusText);
              }
            });
          },
          select: function (event, ui) 
          {
            log( "Selected: id = " + ui.item.id + ", label =  " + ui.item.label + "desc: " + ui.item.desc );
          }
        });


      </script>



    </div>

  </div>
</section>




<section class="main-query">
  <div class="row center">
    <div class="query-form">

      <form class="send-image-query-form" action="/collector/" method="POST">
        <div class="control-wrapper">
          <input type="hidden" id="imgId" name="imgId" value="<%= newImageObj.id %>">
          <input type="text" id="games" tabindex="1">

        </div>
        <input type="submit" id="submitBtn" value="Submit">
      </form>

    </div>

  </div>
</section>

</body>

<script>



  // define the array of data
  var vecIndexToDescData = [
  




<% 
var data = indexDescData.vecIndexToDescription;
  for (var i = 0; i < data.length; ++i) {
    var arrDesc = data[i].description.split("#");

    for (var j = 0; j < arrDesc.length; ++j) { %>

      {
        "vecIndex": "<%= data[i].wordnetId %>#<%= j %>",
        "description": "<%= arrDesc[j] %>"
      },

  <%}
  }%>

  <% 
  for (var k = 0; k < 20; ++k) { %>

    {
      "vecIndex": "(<%= k %>",
      "description": "("
    },
    {
      "vecIndex": ")<%= k %>",
      "description": ")"
    },
    {
      "vecIndex": "&<%= k %>",
      "description": "&"
    },
    {
      "vecIndex": "|<%= k %>",
      "description": "|"
    },

  <% } %>

    {
      "vecIndex": "&999",
      "description": "&"
    }
];
</script>


<!-- Include footer -->
<%- include common/footer.ejs %>